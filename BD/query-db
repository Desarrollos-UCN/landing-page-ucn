CREATE DATABASE ucnpage;
---
/* Tabla para usuarios y cuento*/
CREATE table ucnpage.users(
    id int not null auto_increment primary key,
    nombres varchar(50) not null,
    apellidos varchar(50) not null,
    colorCabello varchar(50) not null,
    colorOjos varchar(50) not null,
    edad int not null,
    Hobby varchar(100) not null
);
---
drop table ucpage.users;
---
select * from ucpage.users;
---
insert into ucnpage.users(nombres, apellidos, colorCabello, colorOjos, edad, Hobby) values
('Juan', 'Pérez', 'Castaño', 'Marrón', 30, 'Fútbol');
---



/* Tablas para usuarios y pedidos*/
CREATE TABLE ciudades (
    id INT PRIMARY KEY AUTO_INCREMENT,
    nombre VARCHAR(100) NOT NULL,
    departamento VARCHAR(100) NOT NULL
);

CREATE TABLE productos (
    id INT PRIMARY KEY AUTO_INCREMENT,
    nombre VARCHAR(200) NOT NULL,
    descripcion TEXT,
    precio DECIMAL(10,2) NOT NULL
);

CREATE TABLE pedidos (
    id INT PRIMARY KEY AUTO_INCREMENT,
    nombres VARCHAR(100) NOT NULL,
    apellidos VARCHAR(100) NOT NULL,
    ciudad_id INT NOT NULL,
    direccion TEXT NOT NULL,
    celular VARCHAR(20) NOT NULL,
    FOREIGN KEY (ciudad_id) REFERENCES ciudades(id)
);

CREATE TABLE pedido_detalles (
    id INT PRIMARY KEY AUTO_INCREMENT,
    pedido_id INT NOT NULL,
    producto_id INT NOT NULL,
    cantidad INT NOT NULL DEFAULT 1,
    precio_unitario DECIMAL(10,2) NOT NULL,
    subtotal DECIMAL(10,2) GENERATED ALWAYS AS (cantidad * precio_unitario) STORED,ñ
    FOREIGN KEY (pedido_id) REFERENCES pedidos(id) ON DELETE CASCADE,
    FOREIGN KEY (producto_id) REFERENCES productos(id)
);
/* agregar ciudades */
INSERT INTO ciudades (nombre, departamento)
VALUES ('Medellín', 'Antioquia');

/* agregar producto */
INSERT INTO productos (nombre, descripcion, precio)
VALUES ('Laptop Lenovo', 'Laptop con 16GB RAM y 512GB SSD', 3200000.00);

/* instar un pedido */
INSERT INTO pedidos (nombres, apellidos, ciudad_id, direccion, celular)
VALUES ('Juan', 'Pérez', 1, 'Calle 123 #45-67', '3001234567');


/* insertar un detalle pedido */
INSERT INTO pedido_detalles (pedido_id, producto_id, cantidad, precio_unitario)
VALUES (1, 1, 2, 3200000.00);INSERT INTO pedido_detalles (pedido_id, producto_id, cantidad, precio_unitario)
VALUES (1, 1, 2, 3200000.00);

/* consultar ciudades */ 

SELECT * FROM ciudades;

/* consultar productos */
SELECT * FROM productos;

/* consultar los detalles de un peedido */ 
SELECT d.id, pr.nombre AS producto, d.cantidad, d.precio_unitario, d.subtotal
FROM pedido_detalles d
JOIN productos pr ON d.producto_id = pr.id
WHERE d.pedido_id = 1;

/* consultar todos los pedidos y su total*/ 
SELECT p.id, p.nombres, p.apellidos, c.nombre AS ciudad, 
       SUM(d.subtotal) AS total_pedido
FROM pedidos p
JOIN ciudades c ON p.ciudad_id = c.id
JOIN pedido_detalles d ON p.id = d.pedido_id
GROUP BY p.id, p.nombres, p.apellidos, c.nombre;